---
title: "Anotacion de datos de Expresion diferencial con Clusterprofiler"
author: "Dra. Linda Aimara Kempis Calanis"
date: "`r Sys.Date()`"
output:
  prettydoc::html_pretty:
    theme: leonids
    highlight: github
---
## Librer√≠as necesarias:
- **tidyverse**: Manipulaci√≥n de dataframes.
- **clusterProfiler**: Conversi√≥n de IDs y an√°lisis de enriquecimiento.
- **org.Hs.eg.db**: Base de datos anotada de genes Humanos.

```{r}
####Librerias necesarias####
library(clusterProfiler)
library(org.Hs.eg.db)
library(ggplot2)

```

## 2. Cargar datos y ajustar par√°metros

La tabla de expresi√≥n diferencial generada por *edgeR* contiene:

- LogFC: Cambios en la expresi√≥n (log2 Fold Change)
- FDR: Tasa de Falsos Descubrimientos (controla error tipo I)
- gene: Nombre del gen en SYMBOL

Los umbrales utilizados:

- **FDR ‚â§ 0.05**: Controla la proporci√≥n esperada de falsos positivos.
- **|logFC| ‚â• 1**: Significa que el cambio es al menos 2 veces (log2(2)=1).

```{r}
# Debemos elegir la direccion de los archivos
# Leer las tablas necesarias para las comparaciones neonatos vs adultos
res_df1 <-read.table("Neo_vs_Adultos_DiffExp_edgeR.txt")
dim(res_df1)
padj.cutoff <-0.05
lfc.cutoff<- 1
```

## 3. Filtrar genes diferencialmente expresados

Aqu√≠ seleccionamos genes sobreexpresados en neonatos y en adultos:



```{r}
# Seleccionar el entrezgeid de los genes up and down de las tablas

GDE_Neo <- res_df1 %>% filter(FDR<= padj.cutoff & logFC <= -lfc.cutoff)
dim(GDE_Neo)
View(GDE_Neo)
GDE_Adul <- res_df1 %>% filter(FDR<= padj.cutoff & logFC >= lfc.cutoff)
dim(GDE_Adul)

gene_adul <- GDE_Adul$gene
length(gene_adul)
gene_neo  <- GDE_Neo$gene
View(gene_neo)
```

# 4. Extraer los nombres de los genes (SYMBOL)

Aqu√≠ tomamos solo la columna de nombres de genes (SYMBOL), necesaria para convertirlos posteriormente a ENTREZID, ya que bases como KEGG y GO trabajan con esos identificadores.

```{r}
## convertir los genes a entrezgenid
genes_neo_entrez = bitr(gene_neo, fromType = "SYMBOL", toType = "ENTREZID", OrgDb ="org.Hs.eg.db" )
View(genes_neo_entrez)
genes_adu_entrez = bitr(gene_adul, fromType = "SYMBOL", toType = "ENTREZID", OrgDb ="org.Hs.eg.db" )
View(genes_adu_entrez)

col_genes_neo_entrez <- genes_neo_entrez$ENTREZID
col_genes_adu_entrez <- genes_adu_entrez$ENTREZID
```

üß¨ An√°lisis de enriquecimiento funcional (GO)

En esta secci√≥n realizamos:

- Enriquecimiento GO (Biological Processes) para genes diferencialmente expresados en neonatos

- Comparaci√≥n de GO entre neonatos y adultos

- Visualizaci√≥n con dotplots

- Exportaci√≥n de resultados


## üü¶  Enriquecimiento GO para genes de neonatos

La funci√≥n enrichGO() identifica procesos biol√≥gicos (BP) sobrerrepresentados en un conjunto de genes.
Se usa:

- gene: vector de ENTREZID

- OrgDb: base de datos anotada de humano

- ont = "BP": categor√≠a Biological Processes

- pvalueCutoff: umbral de significancia

- qvalueCutoff: controla FDR

```{r}

kk <- enrichGO(
  gene          = col_genes_neo_entrez,  # Lista de ENTREZID de genes expresados en neonatos
  OrgDb         = org.Hs.eg.db,          # Base de datos anotada (Homo sapiens)
  ont           = "BP",                  # Ontolog√≠a: Biological Process
  pvalueCutoff  = 0.05,                  # Valor p m√°ximo permitido
  qvalueCutoff  = 0.1                    # FDR m√°ximo permitido
)

```

## üü©  Visualizaci√≥n del enriquecimiento GO (Dotplot)

**dotplot()** muestra los t√©rminos GO m√°s significativos.
Cada punto representa un proceso biol√≥gico enriquecido.

```{r}
via <- dotplot(kk, showCategory = 20, font.size = 10.5) +
  ggtitle("Enrichment Analysis - Neonatos (GO Biological Process)")

via
```

## üü¶ Crear una lista de genes por grupo

Esta lista es necesaria para comparar enriquecimientos entre neonatos y adultos.

```{r}
lista_NeovsAdu <- list(
  "Neonatos" = col_genes_neo_entrez,  # ENTREZID de neonatos
  "Adultos"  = col_genes_adu_entrez   # ENTREZID de adultos
)

```

üüß  Comparaci√≥n de enriquecimiento GO entre grupos (compareCluster)

```{r}
clusters_GO <- compareCluster(
  geneCluster   = lista_NeovsAdu,     # Lista con Neonatos vs Adultos
  fun           = enrichGO,           # Tipo de an√°lisis: GO
  OrgDb         = "org.Hs.eg.db",
  ont           = "BP",
  pvalueCutoff  = 0.05,
  qvalueCutoff  = 0.1
)

View(clusters_GO)
class(clusters_GO)

```

## üìÅ Guardar tabla de resultados GO
```{r}
write.table(
  clusters_GO,
  file = "clusterprofiler_GO.txt",
  sep = "\t",
  col.names = TRUE
)
```

## Dotplot de procesos biol√≥gicos GO (comparaci√≥n Neonatos vs Adultos)


```{r}
vias_GO <- dotplot(
  clusters_GO,
  showCategory = 20,
  font.size = 9
) + ggtitle("Enrichment Analysis - GO Biological Processes (Comparaci√≥n)")

vias_GO

```

