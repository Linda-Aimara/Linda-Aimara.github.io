---
title: "Normalizaci√≥n"
author: "Dra. Linda Aimara Kempis Calanis"
date: "`r Sys.Date()`"
output:
  prettydoc::html_pretty:
    theme: leonids
    highlight: github
---
## Normalizaci√≥n por TPM:

**normalizaci√≥n por TPM** (Transcripts Per Million),una forma com√∫n de representar niveles de expresi√≥n g√©nica en RNA-Seq, corrigiendo por la longitud del gen
y la profundidad total de secuenciaci√≥n.

## Datos de ejemplo

Supongamos que tenemos tres genes con diferente longitud y n√∫mero de lecturas asignadas:

| Gen | Longitud (kb) | Lecturas asignadas |
| --- | ------------- | ------------------ |
| A   | 2             | 500                |
| B   | 1             | 300                |
| C   | 0.5           | 200                |


## ‚öôÔ∏è Paso 1: Calcular Reads Per Kilobase (RPK)

Corregimos por la longitud del gen:

RPK= lecturas / longitud del gen (kb)

## ‚öñÔ∏è Calcular el factor de escala


<img src="norm/Norm_1.png" alt="Description" width="500" height="300">

## üìäPaso 3: Calcular los TPM

| Gen | RPK | TPM                         |
| --- | --- | --------------------------- |
| A   | 250 | (250 / 950) √ó 1e6 ‚âà 263,158 |
| B   | 300 | (300 / 950) √ó 1e6 ‚âà 315,789 |
| C   | 400 | (400 / 950) √ó 1e6 ‚âà 421,053 |

## üìå Interpretaci√≥n:

El TPM representa la proporci√≥n relativa de expresi√≥n de cada gen dentro de la muestra.

Si sumas todos los TPM de una muestra, siempre obtendr√°s 1,000,000.

Esto permite comparar entre genes o entre muestras de diferente profundidad.



## edgeR

## üß† ¬øQu√© es la normalizaci√≥n por TMM?

La normalizaci√≥n por TMM (Trimmed Mean of M-values) corrige las diferencias en el tama√±o de biblioteca y composici√≥n de expresi√≥n entre muestras de RNA-seq.
Su objetivo es garantizar que las comparaciones entre muestras reflejen diferencias biol√≥gicas reales, no t√©cnicas.

üìå En otras palabras:

TMM ajusta las muestras para que los genes no diferenciales tengan, en promedio, el mismo nivel de expresi√≥n en todas ellas.


## ‚öôÔ∏è ¬øPor qu√© se necesita?

Imagina dos muestras:

| Muestra | Total de lecturas | Comentario           |
| ------- | ----------------- | -------------------- |
| Adulto  | 10 millones       | normal               |
| Neonato | 20 millones       | el doble de lecturas |

Si comparas directamente los conteos, todos los genes en Neonato parecer√°n ‚Äúm√°s expresados‚Äù,
cuando en realidad solo tiene m√°s lecturas totales, no mayor expresi√≥n biol√≥gica.

La normalizaci√≥n TMM corrige eso ‚úÖ

## üî¨ C√≥mo funciona (conceptualmente)

1Ô∏è‚É£ Seleccionar una muestra de referencia

Se escoge una muestra base (por defecto, la primera).

Se comparan las dem√°s muestras con esta referencia.

2Ô∏è‚É£ Calcular M y A para cada gen

M = log‚ÇÇ(ratio) de la abundancia entre la muestra y la referencia.

A = media log‚ÇÇ del nivel de expresi√≥n.

<img src="norm/TMM.png" alt="Description" width="500" height="300">

3Ô∏è‚É£ Trimming (recorte)

Se eliminan genes con M o A extremos:

Genes muy poco expresados (ruidosos).

Genes con grandes diferencias (outliers).

Esto evita que pocos genes muy abundantes distorsionen la normalizaci√≥n.

4Ô∏è‚É£ Promedio recortado (Trimmed Mean)

Se calcula la media ponderada de los M-values restantes.

Este valor representa el factor de ajuste entre las dos muestras.

5Ô∏è‚É£ Factor de normalizaci√≥n (TMM factor)

Se transforma ese valor promedio en un factor multiplicativo (norm.factor),
que ajusta los tama√±os de biblioteca (lib.size) en dge$samples

üìä Ejemplo visual (conceptual)

Imagina que cada punto es un gen:

<img src="norm/TMM2.png" alt="Description" width="500" height="300">

‚û°Ô∏è El promedio de los puntos ‚Äúcentrales‚Äù (sin outliers) se usa para calcular el factor TMM.

Estos norm.factors se multiplican por los tama√±os de biblioteca para obtener tama√±os efectivos, usados internamente en el modelado de conteos y c√°lculo de CPM.

## üîç Diferencia entre TPM y TMM

| Caracter√≠stica | **TPM**                                            | **TMM**                                          |
| -------------- | -------------------------------------------------- | ------------------------------------------------ |
| Nivel de uso   | Normaliza expresi√≥n dentro de una muestra          | Normaliza entre muestras                         |
| Qu√© corrige    | Longitud del gen y profundidad total               | Profundidad total y composici√≥n de muestra       |
| Implementaci√≥n | Directamente en cuantificadores (Salmon, Kallisto) | En an√°lisis de conteos (edgeR)                   |
| Ideal para     | Comparar expresi√≥n relativa de genes               | Comparar expresi√≥n diferencial entre condiciones |


## En resumen

TMM ajusta las bibliotecas para que las diferencias observadas entre muestras reflejen biolog√≠a, no t√©cnica.

**Ventajas:**

- Robusta ante genes extremadamente expresados.

- Adecuada para conteos enteros (RNA-seq crudo).

- Es el m√©todo est√°ndar en edgeR

<img src="norm/TMM3.png" alt="Description" width="500" height="300">

## Multidimensional Scaling

Entender qu√© son las Dim 1 y Dim 2 en un gr√°fico MDS (Multidimensional Scaling) es clave para interpretar correctamente tus resultados de RNA-seq

üß† Imagina esto:

Tienes 6 muestras (3 Adultos y 3 Neonatos),
y para cada una mediste la expresi√≥n de miles de genes (por ejemplo, 20.000).

Entonces‚Ä¶ cada muestra no es solo un punto,
sino un vector de 20.000 dimensiones üò≥
‚Äî una coordenada para cada gen.

üëâ Pero no podemos graficar algo en 20.000 dimensiones, ¬øverdad?
El MDS (Multidimensional Scaling) reduce esa complejidad a algo que s√≠ podamos ver ‚Äî dos dimensiones principales: Dim 1 y Dim 2.

üéØ Qu√© representan Dim 1 y Dim 2

| Dimensi√≥n | Qu√© significa                                                    | Qu√© muestra en el gr√°fico                                        |
| --------- | ---------------------------------------------------------------- | ---------------------------------------------------------------- |
| **Dim 1** | Es la **direcci√≥n con mayor variaci√≥n** entre las muestras       | Diferencias **globales m√°s grandes** (por ejemplo, entre grupos) |
| **Dim 2** | Es la **segunda direcci√≥n m√°s variable**, independiente de Dim 1 | Diferencias **secundarias**, dentro o entre grupos               |


üìä C√≥mo leer tu gr√°fico

- Si los Adultos y Neonatos est√°n separados a lo largo del eje Dim 1,
‚Üí significa que esa es la principal diferencia biol√≥gica entre ellos.

- Si dentro de cada grupo hay ligera variaci√≥n en Dim 2,
‚Üí representa diferencias m√°s peque√±as entre r√©plicas (por ejemplo, variabilidad individual).


<img src="norm/MDS.png" alt="Description" width="500" height="300">



- Las muestras del mismo color (grupo) se agrupan juntas.

- La distancia entre puntos representa qu√© tan diferentes son sus perfiles de expresi√≥n g√©nica.

üí° En resumen:

Dim 1 y Dim 2 son los ejes que resumen las mayores diferencias en tus datos de expresi√≥n.
Son como las ‚Äúdirecciones principales‚Äù donde las muestras se separan seg√∫n su perfil gen√©tico.


